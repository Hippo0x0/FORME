# FORME iOS App 界面交互流程

## 核心用户流程

### 1. 新建研究流程
```
首页 → 点击"新建研究" → 研究创建页 → 填写信息 → 保存 → 研究详情页
```

**详细步骤：**
1. 用户在首页点击"新建研究"按钮
2. 进入研究创建页面
3. 填写研究标题、描述、选择分类
4. 设置初始标签
5. 点击保存按钮
6. 自动跳转到新建的研究详情页
7. 系统提示"研究创建成功"

### 2. 保存资料流程
```
任意页面 → 点击分享 → 选择"保存到FORME" → 解析页面 → 编辑信息 → 保存 → 资料库
```

**详细步骤：**
1. 用户在Safari或其他App中浏览网页
2. 点击分享按钮
3. 在分享菜单中选择"保存到FORME"
4. FORME App打开并自动解析页面内容
5. 显示编辑界面（标题、标签、关联研究）
6. 用户编辑后点击保存
7. 保存成功，返回资料库页面

### 3. 运行分析流程
```
研究详情页 → 点击"运行分析" → 选择分析模型 → 配置参数 → 开始分析 → 查看结果
```

**详细步骤：**
1. 在研究详情页点击"运行分析"按钮
2. 进入分析模型选择页面
3. 选择需要的分析模型（如文本摘要、关联分析等）
4. 配置分析参数
5. 点击"开始分析"按钮
6. 显示分析进度
7. 分析完成后显示结果
8. 可选择保存、分享或重新分析

### 4. 搜索资料流程
```
首页/资料库 → 点击搜索框 → 输入关键词 → 查看结果 → 筛选/排序 → 打开详情
```

**详细步骤：**
1. 在首页或资料库页面点击搜索框
2. 输入搜索关键词
3. 实时显示搜索结果
4. 可使用筛选器（类型、时间、标签）
5. 可切换排序方式（相关度、时间）
6. 点击结果项进入资料详情页

## 页面跳转关系

### 主要导航路径
```
首页 (HomeViewController)
├── 研究详情页 (ResearchDetailViewController)
│   ├── 资料详情页 (MaterialDetailViewController)
│   ├── 分析运行页 (AnalysisRunViewController)
│   └── 编辑研究页 (ResearchEditViewController)
├── 资料库 (LibraryViewController)
│   └── 资料详情页 (MaterialDetailViewController)
│       └── 编辑资料页 (MaterialEditViewController)
├── 分析中心 (AnalysisViewController)
│   └── 分析运行页 (AnalysisRunViewController)
└── 我的页面 (ProfileViewController)
    ├── 设置页面 (SettingsViewController)
    ├── 课题管理页 (TopicManagementViewController)
    └── 统计页面 (StatisticsViewController)
```

### 模态展示页面
```
新建研究页 (ResearchCreateViewController)
资料保存页 (MaterialSaveViewController)
分析配置页 (AnalysisConfigViewController)
标签管理页 (TagManagementViewController)
分享页面 (ShareViewController)
```

## 状态管理流程

### 1. 研究状态流转
```
新建 → 进行中 → 暂停 → 进行中 → 完成 → 归档
```

**状态说明：**
- **新建**：刚创建，未开始
- **进行中**：活跃的研究
- **暂停**：暂时中断
- **完成**：研究目标达成
- **归档**：历史研究，只读

### 2. 资料处理状态
```
解析中 → 已保存 → 分析中 → 已分析 → 已关联
```

**状态说明：**
- **解析中**：正在解析网页内容
- **已保存**：内容保存完成
- **分析中**：正在运行分析
- **已分析**：分析完成
- **已关联**：已关联到研究

### 3. 分析任务状态
```
等待中 → 准备中 → 运行中 → 完成 → 失败
```

**状态说明：**
- **等待中**：任务已创建，等待执行
- **准备中**：准备分析数据
- **运行中**：正在执行分析
- **完成**：分析成功完成
- **失败**：分析执行失败

## 错误处理流程

### 1. 网络错误处理
```
检测网络错误 → 显示错误提示 → 提供重试选项 → 离线模式处理
```

**处理步骤：**
1. 检测到网络连接失败
2. 显示友好的错误提示
3. 提供"重试"按钮
4. 对于可离线操作，进入离线模式
5. 网络恢复后自动同步

### 2. 数据保存失败
```
保存失败 → 显示错误详情 → 提供解决方案 → 自动重试或手动保存
```

**处理步骤：**
1. 数据保存失败
2. 显示具体错误原因
3. 提供解决方案（如清理存储空间）
4. 自动重试或提示用户手动重试
5. 临时保存到草稿箱

### 3. 分析任务失败
```
分析失败 → 显示失败原因 → 提供调整建议 → 重新配置或跳过
```

**处理步骤：**
1. 分析任务执行失败
2. 显示失败原因和日志
3. 提供调整建议（如减少数据量）
4. 允许重新配置参数
5. 可选择跳过该分析

## 数据同步流程

### 1. 自动同步
```
检测变化 → 准备同步数据 → 上传到云端 → 下载更新 → 合并冲突
```

**同步策略：**
- 后台自动同步
- 增量同步，减少流量
- 冲突自动合并（时间戳优先）
- 手动触发同步选项

### 2. 手动同步
```
用户触发同步 → 显示同步进度 → 处理冲突 → 完成同步
```

**用户操作：**
1. 在设置页面点击"立即同步"
2. 显示同步进度条
3. 如有冲突，显示解决界面
4. 同步完成提示

## 权限请求流程

### 1. 首次启动权限请求
```
欢迎页面 → 请求通知权限 → 请求网络权限 → 请求本地存储权限 → 进入主界面
```

**权限说明：**
- **通知权限**：用于研究提醒和Agent建议
- **网络权限**：用于资料同步和AI分析
- **本地存储**：用于保存资料和分析结果

### 2. 运行时权限请求
```
功能需要权限 → 解释用途 → 请求授权 → 处理拒绝 → 提供替代方案
```

**处理逻辑：**
1. 功能需要特定权限时触发
2. 清晰解释权限用途
3. 系统弹窗请求授权
4. 如用户拒绝，提供替代方案
5. 可在设置中重新启用

## 用户体验优化

### 1. 首次使用引导
```
欢迎页 → 功能介绍 → 快速创建示例 → 主要功能演示 → 完成引导
```

**引导内容：**
- 应用核心价值介绍
- 主要功能快速演示
- 创建一个示例研究
- 保存一个示例资料
- 完成引导，进入主界面

### 2. 空状态处理
```
检测空数据 → 显示引导内容 → 提供操作建议 → 链接到相关功能
```

**空状态类型：**
- **空研究列表**：显示"创建第一个研究"引导
- **空资料库**：显示"保存第一个资料"引导
- **空分析结果**：显示"运行第一个分析"引导
- **空搜索结果**：显示搜索建议

### 3. 加载状态优化
```
显示骨架屏 → 加载数据 → 渐入显示 → 错误处理
```

**加载策略：**
- 快速显示骨架屏
- 优先加载可见区域
- 图片懒加载
- 错误时显示占位符

## 性能考虑

### 1. 列表性能优化
```
分页加载 → 图片懒加载 → 单元格复用 → 预加载 → 缓存管理
```

**优化措施：**
- 实现分页加载，避免一次性加载过多数据
- 图片使用懒加载和缓存
- UITableViewCell严格复用
- 预加载下一页数据
- 内存缓存和磁盘缓存结合

### 2. 网络请求优化
```
请求合并 → 缓存策略 → 失败重试 → 优先级管理 → 取消机制
```

**优化措施：**
- 合并多个小请求
- 合理的缓存策略（内存+磁盘）
- 智能重试机制（指数退避）
- 请求优先级管理
- 及时的请求取消

### 3. 内存管理优化
```
图片压缩 → 数据分页 → 及时释放 → 内存警告处理 → 后台清理
```

**优化措施：**
- 图片按需压缩和缩放
- 大数据分页加载
- 及时释放不再使用的资源
- 正确处理内存警告
- 后台定期清理缓存

---

*最后更新：2025-12-29*